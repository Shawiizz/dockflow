<div class="settings-page animate-fade-in">
  <!-- Page Header -->
  <div class="page-header">
    <div class="page-header__left">
      <h1 class="page-header__title">Settings</h1>
      <p class="page-header__subtitle">Edit your Dockflow configuration files</p>
    </div>
  </div>

  <!-- Tabs -->
  <div class="config-editor card">
    <p-tabs [value]="activeIndex()" (valueChange)="activeIndex.set(+$event!)">
      <p-tablist>
        @for (tab of tabs(); track tab.fileName; let i = $index) {
          <p-tab [value]="i">
            <i [class]="tab.icon"></i>
            <span>{{ tab.label }}</span>
            @if (tab.dirty) {
              <span class="tab-header__dirty">‚óè</span>
            }
          </p-tab>
        }
      </p-tablist>

      @for (tab of tabs(); track tab.fileName; let i = $index) {
        <p-tabpanel [value]="i">
          <!-- Loading -->
          @if (tab.loading) {
            <div class="editor-loading">
              @for (j of [1, 2, 3, 4, 5, 6, 7, 8]; track j) {
                <p-skeleton [height]="'20px'" styleClass="mb-1" />
              }
            </div>
          } @else if (tab.error && !tab.content) {
            <!-- Error -->
            <div class="editor-error">
              <p-message severity="error" [text]="tab.error" />
            </div>
          } @else {
            <!-- Editor -->
            <div class="editor-wrapper">
              <textarea
                class="editor-textarea"
                [value]="tab.content"
                (input)="onContentChange(i, $any($event.target).value)"
                spellcheck="false"
                autocomplete="off"
                autocorrect="off"
                autocapitalize="off"
              ></textarea>
            </div>

            <!-- Error message -->
            @if (tab.error) {
              <div class="editor-error-inline">
                <p-message severity="error" [text]="tab.error" />
              </div>
            }

            <!-- Actions -->
            <div class="editor-actions">
              <button
                class="btn btn--primary"
                (click)="save(i)"
                [disabled]="!tab.dirty || saving()"
              >
                <i class="pi pi-save" [class.pi-spin]="saving()"></i>
                <span>Save</span>
              </button>
              <button
                class="btn btn--ghost"
                (click)="revert(i)"
                [disabled]="!tab.dirty"
              >
                <i class="pi pi-undo"></i>
                <span>Revert</span>
              </button>
              <button
                class="btn btn--ghost"
                (click)="loadConfig(i)"
                pTooltip="Reload from disk"
              >
                <i class="pi pi-refresh"></i>
                <span>Reload</span>
              </button>
            </div>
          }
        </p-tabpanel>
      }
    </p-tabs>
  </div>

  <p-toast position="top-right" />
</div>
