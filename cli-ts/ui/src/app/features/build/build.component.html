<div class="build-page animate-fade-in">
  <div class="page-header">
    <div class="page-header__left">
      <h1 class="page-header__title">Build</h1>
      <p class="page-header__subtitle">Build Docker images for your services</p>
    </div>
  </div>

  <div class="card" style="padding: 1.5rem; display: flex; flex-direction: column; gap: 1rem;">
    <div class="flex flex-wrap gap-4">
      <div class="flex flex-col gap-1" style="min-width: 10rem;">
        <label class="text-sm text-muted">Services filter</label>
        <input type="text" pInputText [(ngModel)]="servicesFilter" placeholder="e.g. web,api" style="width: 100%;">
      </div>
    </div>
    <div class="flex flex-wrap gap-4">
      <div class="flex items-center gap-2">
        <p-checkbox [(ngModel)]="push" [binary]="true" inputId="push" />
        <label for="push">Push to registry</label>
      </div>
    </div>
    <div class="flex gap-2">
      <button class="btn btn--primary" (click)="startBuild()" [disabled]="building() || !envService.selectedOrUndefined()">
        <i class="pi pi-hammer"></i>
        <span>{{ building() ? 'Building...' : 'Build' }}</span>
      </button>
      @if (building()) {
        <button class="btn btn--danger" (click)="cancelBuild()">
          <i class="pi pi-times"></i>
          <span>Cancel</span>
        </button>
      }
    </div>
  </div>

  @if (buildLogs().length > 0) {
    <div class="card" style="padding: 0; margin-top: 1rem;">
      <div style="padding: 0.75rem 1rem; border-bottom: 1px solid var(--border-primary); display: flex; align-items: center; justify-content: space-between;">
        <span class="text-sm font-medium">Output</span>
        @if (buildSuccess() === true) {
          <p-tag value="Success" severity="success" [rounded]="true" />
        } @else if (buildSuccess() === false) {
          <p-tag value="Failed" severity="danger" [rounded]="true" />
        } @else if (building()) {
          <p-tag value="Running" severity="info" [rounded]="true" />
        }
      </div>
      <div #outputContainer style="background: #0a0a0a; color: #fafafa; font-family: 'JetBrains Mono', monospace; font-size: 0.8125rem; padding: 1rem; max-height: 30rem; overflow-y: auto; white-space: pre-wrap; word-break: break-all;">
        @for (line of buildLogs(); track $index) {
          <div>{{ line }}</div>
        }
      </div>
    </div>
  }
</div>
